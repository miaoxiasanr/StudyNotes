- [图形学面试题](#图形学面试题)

# 图形学面试题
1.  渲染管线
渲染管线是一堆原始图形数据经过各种变化处理最终出现在屏幕的过程。渲染管线可分为三个阶段：应用程序阶段，几何阶段，光栅化阶段
> * 应用程序阶段是由CPU主要负责。CPU将GPU绚烂所需要的灯光，模型准备好，并设置好渲染状态，为GPU渲染做好准备
> * 几何阶段是吧输入的3D数据转换成2D数据。包括顶点着色器、图元装置、剪裁和屏幕映射几个过程。顶点着色器主要进行顶点坐标变换.将输入的模型空间顶点坐标变换到裁剪空间顶点坐标。图元装配将顶点装配转成指定图元的形状。几何着色器改变图元。通过产生新顶点构造出来新的图元来生成其他形状。
> 光栅化阶段是把图元映射成最终屏幕撒花姑娘显示的颜色。包括光栅化、片段着色、深度测试和混合。光栅化将顶点转为屏幕上的像素，片段着色器计算每个像素的最终颜色。深度测试通过深度信息判断像素的遮挡关系。混合阶段将通过透明度将像素进行混合。
> 最终将渲染好的颜色先送入后置缓冲中，随后再替换前置缓冲，显示在屏幕上。

2. 什么是Depth buffer
   深度缓冲也称Z-buffer，用来储存深度值以及在深度测试时确定一个片段是否被其他片段遮拦。深度缓冲有窗口系统自动创建并将其深度值储存为16.24或32位浮点数。在大多数系统中深度缓冲区为24位。
   当启用深度缓冲时，如果此深度缓冲测试通过 ，深度缓冲内的值将设为新的深度值。如果深度测试失败，则将丢弃该片段。
3. 提前深度测试
   提前深度测试是一个由图形硬件支持的功能
    提前深度测试允许深度测试在片段着色器之前运行。可以更早的踢掉一些片段永远可见的片元，节省GPU资源。
4. Phong和Billin-Phong
   Phong光照模型分为三部分：环境光(Ambient),漫反射光(Diffuse),镜面反射光(Specular)。环境光即来自其他物体，危废直接光源的光照。在Phong模型中是一个常数。漫反射即粗糙物体表面均匀的反射光线到各个方向所产生的光照效果。镜面反射野生高光反射，有光滑物体表面平行的向一个方向反射出来的光照效果。Phong模型中，视线向量和反射向量的角度不允许大于90度，如果大于90度，点乘的结果将是负数，镜面和漫反射的贡献就将变成0；
   Billin-Phong光照模型和Phong光照模型基本一样，就只是镜面反射的计算引入了半程向量，半程向量是视线方向和反射向量之间的夹角。通过测量法线和半程向量之间的角度计算镜面反射。
5. 前向渲染和延迟渲染的区别
   * 前向渲染对于将每一个需要渲染的物体，都要进行逐光源渲染，每个光源都会带来一定的渲染成本。
   * 延迟渲染
        将计算量非常大的渲染延时到后期进行处理
        包含两个处理阶段：在几何处理阶段中，先渲染场景一次，之后获取对象的各种几何信息，并储存在G-buffer中，随后在光照处理阶段中使用G-buffer内的纹理数据对每一个片段计算场景的光照；
        延迟渲染只需要对每一个像素执行一次光照运算，能够渲染大量的光源而不消耗大量的性能；
        延迟渲染不能进行混合，因为G-buffer中所有的数据都是一个单独的片段中来的，而混合需要多个片段的组合进行操作
        延迟渲染需要大的内存开销，没有MSAA
        延迟渲染对很小且没有很多光源的场景，并不一定很快
        延迟渲染不支持半透明物体的绚烂
6. 如何优化Shader计算量
   将计算从片段着色器移动到顶点着色器，在脚本中计算并传递给片段着色器。
   使用纹理读取的方式减轻运算量。
   尽量使用内建函数
7. 顶点着色器实现光照会怎么样
   逐顶点光照，也称为高诺德着色。在顶点着色器中对每一个顶点进行光照计算，然后会在渲染图元上进行线性插值，最后输出像素着色。
   逐顶点光照的性能开销远远小于逐像素，因为顶点数远远小于像素数，但是由于逐顶点的像素依赖于顶点的线性插值来去得效果，因此只要是非线性的光照计算使用逐像素光照都会或多或少的产生有问题的效果(效果不一定正确)
8. 顶点着色器作用
   顶点着色器是对顶点的一系列操作的着色器，对物体顶点进行控制，如位置改变，能实现各类效果如布类仿真，高级别动画，实时修改透视效果
9.  顶点着色器到片段着色器中间流程
    顶点着色器到片段着色器需要经过:图元装配，几何着色器，光栅化
    图元装配：将顶点着装配成指定图元的形状(如三角形)
    几何着色器：改变图元，通过产生构造新的图元来生成其他形状。
    光栅化：把图元映射成最终屏幕上响应的元素(把三角形切分成一个个像素)
10. 几何着色器的作用
    结合着色器在顶点和片段着色器之间，是一种可选的可编程的着色器。他能够将顶点变换为完全不同的图元，并且还能生成比原来更多的顶点。
11. Drawcall 原理以及如何减少DrawCall
    Drawcall是对底层图形绘制接口的调用命令，调用GPU进行渲染。CPU往GPU发送渲染命令，GPU接受并执行相应的渲染命令。
    优化：
    在UI上，使用图集，批渲染将一些渲染状态一致的物体合并成一个大物体，吧图集转移到一张大图片，一次提交给GPU进行渲染
    模型上，每一帧吧可以进行批处理的模型网格进行合并，在把合并后模型数据传递给GPU，然后使用同一个材质对其渲染。
12. 光栅化的作用
    是把顶点数据转换成片元的过程，即将几何图元变成二维图像的过程，将三维场景投影到平面
13. 点乘、叉乘的几何意义即用处
    * 点乘的几何意义可以用来表示或计算两个向量之间的夹角，以及在b向量在a向量上的投影。从而及进一步判断这两个向量是否为同一方向，是否垂直等方向关系
    * 可以通过两个向量的叉乘，生成第三个垂直于a,b的法向量，从而构建X,Y,Z坐标系，除此之外，叉乘还有一个几何意义就是：a*b等于向量a和向量b构成的平行四边形的面积。
14. 如何判断一个点在一个凸边形内部
    1. 面积和判别法：判断目标点与多边形点的每条边组成的三角形和是否等于该多边形，相等则在多边形内部
    2. 夹角和判断法：判断目标点与所有边的夹角和是否为360度，为360度则在多边形内部
    3. 引射线法：从目标点出发引一条射线，看这条射线与多边形所有边的交点数目，如果有奇数个交点则在内部，偶数个交点则在外部
15. 什么是齐次坐标？齐次坐标有什么用？
    * 所谓齐次坐标就是为矢量或者矩阵增加一个维度，2D平面使用三维向量和三维矩阵，3D空间使用四维向量和四维矩阵；额外的坐标值是任意的，可看做是缩放或者权重
    * 三维矩阵可以表示旋转和缩放，他们相乘的结果是正确的的，但是平移变换不能加到三维矩阵中的相乘去表达，只能将矩阵相乘的结果加一个三维向量；引入齐次坐标之后会增加一个维度变为四维矩阵，多出来的一维向量用来表示平移，那么就可以在一个矩阵中统一所有的操作：平移，旋转、缩放
